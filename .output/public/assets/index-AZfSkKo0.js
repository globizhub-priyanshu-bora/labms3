import{R as ae,r,u as C,j as e,B as a,b as D,X as Q,L as x,d as U,s as le,e as ce,t as k,f as ie,h as de,i as ne}from"./main-DKZ1eiYM.js";import{L as xe}from"./Layout-B54LSfe1.js";import{P as oe}from"./plus-COP95Qi3.js";import{S as me}from"./search-DUEBBEPa.js";import{S as he,T as pe}from"./trash-2-Cwax-49T.js";import"./user-ZdgPDPxn.js";function Se(){const E=ae.useLoaderData(),[V,$]=r.useState(E?.tests?.data||[]),[m,ye]=r.useState(E?.parameters?.data||[]),[z,h]=r.useState(!1),[X,p]=r.useState(!1),[N,A]=r.useState(null),[y,w]=r.useState(""),[G,u]=r.useState([]),[n,g]=r.useState(!1),[c,d]=r.useState([]),[S,i]=r.useState("0.00"),[o,q]=r.useState(""),[I,L]=r.useState([]),{register:M,handleSubmit:H,reset:J,setValue:B,formState:{errors:b,isSubmitting:F}}=C(),{register:O,handleSubmit:K,reset:W,setValue:ue,formState:{errors:j,isSubmitting:R}}=C(),{register:Y,handleSubmit:Z}=C();r.useEffect(()=>{if(o){const s=m.filter(t=>t.name.toLowerCase().includes(o.toLowerCase()));L(s)}else L(m)},[o,m]),r.useEffect(()=>{(async()=>{if(c.length===0){i("0.00");return}try{const t=await U({data:{parameterIds:c}});t.success&&(i(t.totalPrice),B("price",t.totalPrice))}catch(t){console.error("Error calculating price:",t)}})()},[c,B]);const v=async()=>{try{const s=await ne({data:{limit:100,offset:0,sortBy:"name",sortOrder:"asc"}});s.success&&$(s.data)}catch(s){console.error("Error loading tests:",s)}},f=s=>{d(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},_=async s=>{try{(await ie({data:{name:s.name,price:s.price,parameterIds:c}})).success&&(h(!1),J(),d([]),i("0.00"),await v())}catch(t){console.error("Error adding test:",t),k.error(t instanceof Error?t.message:"Failed to add test")}},P=async s=>{if(!s.query.trim()){u([]),g(!1);return}try{const t=await le({data:{query:s.query,limit:50,offset:0}});t.success&&(u(t.data),g(!0))}catch(t){console.error("Error searching tests:",t)}},ee=async s=>{A(s);const t=s.metadata?.parameterIds||[];if(d(t),W({name:s.name,price:s.price}),t.length>0)try{const l=await U({data:{parameterIds:t}});l.success&&i(l.totalPrice)}catch(l){console.error("Error calculating price:",l)}p(!0)},se=async s=>{if(N)try{(await de({data:{id:N.id,name:s.name,price:s.price,parameterIds:c}})).success&&(p(!1),A(null),d([]),i("0.00"),await v(),n&&await P({query:y}))}catch(t){console.error("Error updating test:",t),k.error(t instanceof Error?t.message:"Failed to update test")}},te=async s=>{if(confirm("Are you sure you want to delete this test?"))try{(await ce({data:{id:s}})).success&&(await v(),n&&await P({query:y}))}catch(t){console.error("Error deleting test:",t),k.error("Failed to delete test")}},T=n?G:V,re=s=>{const t=s.metadata?.parameterIds||[];return m.filter(l=>t.includes(l.id))};return e.jsx(xe,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white border border-gray-300 mb-4 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Test Bundles Management"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[T.length," test(s) ",n&&`for "${y}"`]})]}),e.jsxs(a,{onClick:()=>h(!0),className:"px-4 py-2",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Add Test"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Search Tests"}),e.jsxs("form",{onSubmit:Z(P),children:[e.jsx("input",{type:"text",placeholder:"Search...",...Y("query"),onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-2"}),e.jsxs("button",{type:"submit",className:"w-full px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),"Search"]})]}),n&&e.jsx(a,{onClick:()=>{g(!1),u([]),w("")},className:"w-full mt-2 px-3 py-2 text-sm",children:"Clear Search"})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"bg-white border border-gray-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Test Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Parameters"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Price (₹)"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-12 text-center",children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(D,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No tests found"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:['No results for "',y,'"']}),e.jsx(a,{onClick:()=>{g(!1),u([]),w("")},className:"mt-3 px-4 py-2 text-sm",children:"Clear Search"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(D,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No tests available"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:'Click "Add Test" to create one'})]})})}):T.map(s=>{const t=re(s);return e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.length>0?t.map(l=>l.name).join(", "):"-"}),e.jsxs("td",{className:"px-4 py-3 text-gray-900",children:["₹",s.price]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(a,{onClick:()=>ee(s),className:"px-2 py-1",title:"Edit",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(a,{onClick:()=>te(s.id),variant:"destructive",className:"px-2 py-1",title:"Delete",children:e.jsx(pe,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white border border-gray-400 max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Test Bundle"}),e.jsx(a,{variant:"destructive",onClick:()=>{h(!1),d([]),i("0.00")},className:"p-1",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:H(_),className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Test Name *"}),e.jsx("input",{type:"text",...M("name",{required:"Test name is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),b.name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:b.name.message})]}),e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Price (₹) *"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"text",...M("price",{required:"Price is required"}),className:"flex-1 px-3 py-2 border border-gray-300 text-sm",placeholder:`Calculated: ${S}`})}),b.price&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:b.price.message}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Calculated: ₹",S]})]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4",children:[e.jsxs(x,{className:"block text-sm font-medium text-gray-900 mb-2",children:["Select Parameters (",c.length," selected)"]}),e.jsx("input",{type:"text",placeholder:"Search parameters...",value:o,onChange:s=>q(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-3"}),e.jsx("div",{className:"border border-gray-300 max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900 w-12",children:"Select"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Parameter"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-900",children:"Price"})]})}),e.jsx("tbody",{children:I.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>f(s.id),children:[e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>f(s.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.name}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:s.unit||"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:s.price?`₹${s.price}`:"-"})]},s.id))})]})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(a,{type:"button",variant:"destructive",onClick:()=>{h(!1),d([]),i("0.00")},className:"flex-1 px-3 py-2 text-sm",children:"Cancel"}),e.jsx(a,{type:"submit",disabled:F,className:"flex-1 px-3 py-2 text-sm",children:F?"Adding...":"Add Test"})]})]})]})}),X&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white border border-gray-400 max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Edit Test Bundle"}),e.jsx(a,{onClick:()=>{p(!1),d([]),i("0.00")},className:"p-1 bg-white border border-gray-400",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:K(se),className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Test Name *"}),e.jsx("input",{type:"text",...O("name",{required:"Test name is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),j.name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:j.name.message})]}),e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Price (₹) *"}),e.jsx("input",{type:"text",...O("price",{required:"Price is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),j.price&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:j.price.message}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Calculated: ₹",S]})]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4",children:[e.jsxs(x,{className:"block text-sm font-medium text-gray-900 mb-2",children:["Select Parameters (",c.length," selected)"]}),e.jsx("input",{type:"text",placeholder:"Search parameters...",value:o,onChange:s=>q(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-3"}),e.jsx("div",{className:"border border-gray-300 max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900 w-12",children:"Select"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Parameter"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-900",children:"Price"})]})}),e.jsx("tbody",{children:I.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>f(s.id),children:[e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>f(s.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.name}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:s.unit||"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:s.price?`₹${s.price}`:"-"})]},s.id))})]})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(a,{type:"button",onClick:()=>{p(!1),d([]),i("0.00")},className:"flex-1 px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:"Cancel"}),e.jsx(a,{type:"submit",disabled:R,className:"flex-1 px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:R?"Updating...":"Update Test"})]})]})]})})]})})}export{Se as component};
