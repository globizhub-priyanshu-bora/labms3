import{a2 as R,r as m,j as e,B as c,X as F,L as f,a3 as L,t as r,a4 as B,a5 as w,a6 as T}from"./main-7-PV94Mj.js";import{u as O,L as N}from"./Layout-BjyUM3rL.js";import{P as V}from"./plus-DgpzP6ir.js";import{S as z,T as M}from"./trash-2-B2o36O0X.js";function J(){const{user:X}=O(),k=R.useLoaderData(),[p,h]=m.useState(k?.data||[]),[b,o]=m.useState("users"),[y,u]=m.useState(null),[g,i]=m.useState(!1),[t,d]=m.useState({name:"",email:"",password:"",role:"",phoneNumber:void 0,permissions:{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}}),U=[{key:"patients",label:"Patients"},{key:"bills",label:"Bills"},{key:"tests",label:"Tests"},{key:"parameters",label:"Parameters"},{key:"doctors",label:"Doctors"},{key:"reports",label:"Reports"},{key:"users",label:"Users"}],j=["view","create","edit","delete"],n=()=>{d({name:"",email:"",password:"",role:"",phoneNumber:void 0,permissions:{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}})},E=()=>{n(),o("add")},S=s=>{u(s),d({name:s.name,email:s.email,password:"",role:s.role,phoneNumber:s.phoneNumber||void 0,permissions:s.permissions||{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}}),o("edit")},A=async s=>{if(confirm("Are you sure you want to delete this user?"))try{const a=await L({data:{id:s}});a.success?(h(p.filter(l=>l.id!==s)),r.success("User deleted successfully")):r.error(a.error||"Failed to delete user")}catch(a){console.error("Error deleting user:",a),r.error(a instanceof Error?a.message:"Failed to delete user")}},C=async s=>{s.preventDefault(),i(!0);try{if(!t.name.trim()){r.error("Name is required"),i(!1);return}if(!t.email.trim()){r.error("Email is required"),i(!1);return}if(!t.password.trim()){r.error("Password is required"),i(!1);return}if(!t.role.trim()){r.error("Role is required"),i(!1);return}const a=await T({data:t});if(a.success){const l=await w({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});l.success?(h(l.data),r.success("User created successfully"),o("users"),n()):r.error("User created but failed to reload list")}else r.error(a.error||"Failed to create user")}catch(a){console.error("Error creating user:",a),r.error(a instanceof Error?a.message:"Failed to create user")}finally{i(!1)}},D=async s=>{if(s.preventDefault(),!!y){i(!0);try{if(!t.name.trim()){r.error("Name is required"),i(!1);return}if(!t.email.trim()){r.error("Email is required"),i(!1);return}if(!t.role.trim()){r.error("Role is required"),i(!1);return}const a={id:y.id,name:t.name,email:t.email,role:t.role,phoneNumber:t.phoneNumber,permissions:t.permissions};t.password&&(a.password=t.password);const l=await B({data:a});if(l.success){const v=await w({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});v.success?(h(v.data),r.success("User updated successfully"),o("users"),u(null),n()):r.error("User updated but failed to reload list")}else r.error(l.error||"Failed to update user")}catch(a){console.error("Error updating user:",a),r.error(a instanceof Error?a.message:"Failed to update user")}finally{i(!1)}}},q=(s,a)=>{d(l=>({...l,permissions:{...l.permissions,[s]:{...l.permissions[s],[a]:!l.permissions[s]?.[a]}}}))},P=(s,a)=>{d(l=>({...l,permissions:{...l.permissions,[s]:{view:a,create:a,edit:a,delete:a}}}))};if(b==="users")return e.jsx(N,{requiredRole:["admin"],children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsxs(c,{onClick:E,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Add User"]})]}),p.length===0?e.jsx("div",{className:"bg-white rounded-lg p-8 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No users found"})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.role}),e.jsxs("td",{className:"px-6 py-4 text-right text-sm space-x-2",children:[e.jsx(c,{onClick:()=>S(s),variant:"outline",className:"px-3 py-1",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx(c,{onClick:()=>A(s.id),variant:"destructive",className:"px-3 py-1",children:e.jsx(M,{className:"w-4 h-4"})})]})]},s.id))})]})})]})});const x=b==="edit";return e.jsx(N,{requiredRole:["admin"],children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:x?"Edit User":"Add New User"}),e.jsxs(c,{onClick:()=>{o("users"),n(),u(null)},variant:"outline",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("form",{onSubmit:x?D:C,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>d({...t,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Enter user name"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>d({...t,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Enter email"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(f,{className:"block text-sm font-medium text-gray-900 mb-1",children:["Password ",x&&"(Leave blank to keep current)","*"]}),e.jsx("input",{type:"password",value:t.password,onChange:s=>d({...t,password:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Enter password"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Role *"}),e.jsxs("select",{value:t.role,onChange:s=>d({...t,role:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Select role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"lab_tech",children:"Lab Technician"}),e.jsx("option",{value:"cashier",children:"Cashier"}),e.jsx("option",{value:"doctor",children:"Doctor"})]})]})]}),e.jsxs("div",{children:[e.jsx(f,{className:"block text-sm font-medium text-gray-900 mb-3",children:"Permissions"}),e.jsx("div",{className:"space-y-4",children:U.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.label}),e.jsx("button",{type:"button",onClick:()=>{const a=j.some(l=>t.permissions[s.key]?.[l]);P(s.key,!a)},className:"text-sm text-blue-600 hover:text-blue-700",children:"Toggle All"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:j.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.permissions[s.key]?.[a]||!1,onChange:()=>q(s.key,a),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:a})]},a))})]},s.key))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(c,{type:"button",onClick:()=>{o("users"),n(),u(null)},variant:"outline",children:"Cancel"}),e.jsx(c,{type:"submit",disabled:g,className:"bg-blue-600 hover:bg-blue-700",children:g?"Saving...":x?"Update User":"Create User"})]})]})})]})})}export{J as component};
