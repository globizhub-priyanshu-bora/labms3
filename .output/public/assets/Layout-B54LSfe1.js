import{c as i,w,r as c,j as e,g as A,Z as x,X as _,a7 as L,a8 as C}from"./main-DKZ1eiYM.js";import{U,A as $}from"./user-ZdgPDPxn.js";const S=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],v=i("chevron-down",S);const D=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],I=i("flask-conical",D);const P=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],b=i("layout-dashboard",P);const z=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],E=i("menu",z);const H=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],F=i("power",H);const T=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],V=i("receipt",T);const O=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Z=i("settings",O);const B=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],G=i("stethoscope",B);const X=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],J=i("test-tube",X);const K=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],N=i("users",K);function Q(t,r){return t==="admin"||t==="Admin"||!r?!0:(Array.isArray(r)?r:[r]).some(m=>t.toLowerCase()===m.toLowerCase())}const k=c.createContext({user:null,loading:!0}),W=()=>c.useContext(k),Y=({children:t,requiredRole:r})=>{const l=w(),[m,p]=c.useState(null),[g,o]=c.useState(!0),[u,d]=c.useState(null);return c.useEffect(()=>{(async()=>{try{const h=await A();if(!h.success||!h.user){o(!1),l({to:"/"});return}const a=h.user;if(!a.hasCompletedSetup||!a.labId){o(!1),l({to:"/lab-setup"});return}if(r&&!Q(a.role,r)){d(`Access denied. This page requires ${Array.isArray(r)?r.join(", "):r} role.`),o(!1);return}p(a),o(!1)}catch(h){console.error("Auth check error:",h),d("Failed to verify authentication"),o(!1),l({to:"/"})}})()},[l,r]),g?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"text-center max-w-md",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:u}),e.jsx("button",{onClick:()=>l({to:"/dashboard"}),className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded",children:"Go to Dashboard"})]})})}):e.jsx(k.Provider,{value:{user:m,loading:g},children:t})},q=()=>{const{user:t}=W(),r=w(),[l,m]=c.useState(!1),[p,g]=c.useState(!1),[o,u]=c.useState(!1),[d,f]=c.useState(null);c.useEffect(()=>{t&&(async()=>{try{const n=await L();n.success&&f(n.data)}catch(n){console.error("Error fetching lab info:",n)}})()},[t]);const h=async()=>{try{await C(),r({to:"/"})}catch(s){console.error("Logout error:",s),r({to:"/"})}};if(!t)return null;const a=(s,n)=>{if(t.isAdmin)return!0;const y=t.permissions||{};if(y[s]?.[n]===!0)return!0;const M=s.replace(/s$/,"");return y[M]?.[n]===!0||n==="read"&&y[s]?.view===!0},j=(()=>{const s=[];return t.isAdmin?s.push({type:"dropdown",label:"User Management",icon:Z}):s.push({to:"/dashboard",label:"Dashboard",icon:b}),(a("patients","create")||a("patient","create"))&&s.push({to:"/patients/register",label:"Register Patient",icon:U}),(t.isAdmin||a("doctors","view")||a("doctors","create")||a("doctor","view")||a("doctor","create"))&&s.push({to:"/doctors",label:"Doctors",icon:G}),(a("tests","view")||a("tests","read")||a("test","read"))&&s.push({to:"/tests/",label:"Tests",icon:J}),(a("parameters","view")||a("parameters","read")||a("test_parameter","read"))&&s.push({to:"/test-parameters/",label:"Parameters",icon:$}),(a("bills","view")||a("bills","create")||a("bill","read"))&&s.push({to:"/bills/$id",label:"Bills",icon:V}),s.push({to:"/lab-management",label:"Lab Management",icon:b}),s})();return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(x,{to:t.isAdmin?"/lab-management":"/dashboard",className:"flex items-center gap-3 group",children:[e.jsx("div",{className:"bg-black text-white p-2 rounded-lg transition-colors group-hover:bg-gray-800",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Lab Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Professional Healthcare Lab"})]})]}),e.jsx("div",{className:"hidden lg:flex items-center gap-1",children:j.map((s,n)=>s.type==="dropdown"?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>u(!o),className:"px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-md inline-flex items-center gap-1 transition-colors",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,e.jsx(v,{className:`w-4 h-4 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{className:"absolute left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg py-2 z-50",children:[e.jsxs(x,{to:"/dashboard",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Dashboard"]}),e.jsxs(x,{to:"/admin/dashboard",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"User Management"]})]})]},n):e.jsxs(x,{to:s.to,className:"px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-md inline-flex items-center gap-2 transition-colors",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},n))}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>g(!p),className:"px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md inline-flex items-center gap-2 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"hidden sm:inline text-sm font-medium text-gray-900",children:t.name.split(" ")[0]})]}),p&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg py-2 z-50",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-gray-200 text-xs text-gray-500",children:[e.jsx("p",{children:t.email}),e.jsx("p",{className:"text-blue-600 font-semibold",children:t.isAdmin?"Administrator":"User"})]}),e.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Logout"]})]})]}),e.jsx("button",{onClick:()=>m(!l),className:"lg:hidden p-2 text-gray-700 hover:bg-gray-50 rounded-md",children:l?e.jsx(_,{className:"w-6 h-6"}):e.jsx(E,{className:"w-6 h-6"})})]})]}),l&&e.jsx("div",{className:"lg:hidden pb-4 border-t border-gray-200 space-y-1",children:j.map((s,n)=>s.type==="dropdown"?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>u(!o),className:"w-full text-left px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-md flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,e.jsx(v,{className:`w-4 h-4 ml-auto transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{to:"/dashboard",className:"ml-4 block px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Dashboard"]}),e.jsxs(x,{to:"/admin/dashboard",className:"ml-4 block px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-md flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"User Management"]})]})]},n):e.jsxs(x,{to:s.to,className:"block px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-md flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},n))})]})}),d&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-200 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-7xl mx-auto py-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:d.name}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:["Reg. No: ",d.registrationNumber||"N/A"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:e.jsx("p",{children:d.addressLine1})})]})})})]})},te=({children:t,requiredRole:r})=>e.jsx(Y,{requiredRole:r,children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(q,{}),e.jsx("main",{children:t})]})});export{te as L,N as U,W as u};
