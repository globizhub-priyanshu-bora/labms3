import{j as e,S as P,r as i,b as f,B as c,w as R,T as I,U as T,V as k}from"./main-vMwdSAIQ.js";import{u as q}from"./index.esm-D6iZMFZI.js";import{L}from"./Layout-CaoylRxh.js";import{F as x}from"./file-text-D40v4ExQ.js";import{D as j}from"./dollar-sign-mu9BeRyW.js";import{S as v}from"./search-DGwleQtH.js";import"./user-C1TGoub_.js";function E(){const w=P.useLoaderData(),[S,A]=i.useState(w?.data||[]),[d,o]=i.useState(""),[m,h]=i.useState([]),[l,g]=i.useState(!1),[u,y]=i.useState(!1),{register:B,handleSubmit:N}=q(),F=async()=>{y(!0);try{const s=await k({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});s.success&&(A(s.data),l&&d&&p({query:d}))}catch(s){console.error("Error loading bills:",s)}finally{y(!1)}},p=async s=>{const t=s.query.trim();if(!t){h([]),g(!1),o("");return}try{const n=await T({data:{query:t,limit:100,offset:0}});n.success&&(h(n.data),g(!0),o(t))}catch(n){console.error("Error searching bills:",n),showToast("Failed to search bills. Please try again.")}},b=()=>{g(!1),h([]),o("")},a=l?m:S,D=s=>s?new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",C=s=>s?e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded",children:"PAID"}):e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded",children:"UNPAID"}),r={total:a.length,paid:a.filter(s=>s.bill.isPaid).length,unpaid:a.filter(s=>!s.bill.isPaid).length,totalAmount:a.reduce((s,t)=>s+parseFloat(t.bill.finalAmount),0),paidAmount:a.filter(s=>s.bill.isPaid).reduce((s,t)=>s+parseFloat(t.bill.finalAmount),0)};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(x,{className:"w-8 h-8 text-blue-600"}),"Bills Management"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View and manage all laboratory bills"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Bills"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.total})]}),e.jsx(x,{className:"w-10 h-10 text-blue-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Paid Bills"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.paid})]}),e.jsx(j,{className:"w-10 h-10 text-green-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unpaid Bills"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.unpaid})]}),e.jsx(f,{className:"w-10 h-10 text-red-600 opacity-20"})]})}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue Collected"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["₹",r.paidAmount.toFixed(2)]})]}),e.jsx(j,{className:"w-10 h-10 text-blue-600 opacity-20"})]})})]}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg shadow-sm mb-4",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("form",{onSubmit:N(p),className:"flex-1 min-w-[300px] max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by invoice number, patient name, or patient ID...",...B("query"),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{type:"submit",onClick:N(p),className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Search"]}),l&&e.jsx(c,{onClick:b,variant:"destructive",className:"px-4 py-2 text-sm",children:"Clear Search"}),e.jsxs(c,{onClick:F,disabled:u,className:"px-4 py-2 text-sm",children:[e.jsx(R,{className:`w-4 h-4 mr-2 ${u?"animate-spin":""}`}),"Refresh"]})]})]}),l&&e.jsx("div",{className:"mt-3 px-3 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Showing results for: ",e.jsxs("span",{className:"font-semibold",children:['"',d,'"']})," ","(",m.length," ",m.length===1?"result":"results"," found)"]})})]})}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Invoice Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Patient Details"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-16 text-center",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(f,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium text-lg",children:"No bills found"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-2",children:['No results matching "',d,'"']}),e.jsx(c,{onClick:b,className:"mt-4 px-6 py-2",children:"Clear Search"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(x,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium text-lg",children:"No bills available"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Bills will appear here once patients are registered"})]})})}):a.map(({bill:s,patient:t})=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-blue-600",children:s.invoiceNumber}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.id.toString().padStart(6,"0")]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t?.name||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[t?.age&&`${t.age} Yrs`,t?.age&&t?.gender&&" • ",t?.gender&&`${t.gender.charAt(0)}`,t?.id&&e.jsxs(e.Fragment,{children:[" • ",e.jsxs("span",{className:"text-blue-600",children:["PID: ",t.id.toString().padStart(6,"0")]})]})]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-gray-900",children:D(s.createdAt)})}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t?.phoneNumber||"-"}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["₹",parseFloat(s.finalAmount).toFixed(2)]}),(parseFloat(s.discount||"0")>0||parseFloat(s.tax||"0")>0)&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Base: ₹",parseFloat(s.totalAmount).toFixed(2)]})]}),e.jsx("td",{className:"px-4 py-3",children:C(s.isPaid)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(I,{to:"/bills/bill/$id",params:{id:s.id.toString()},children:e.jsxs(c,{className:"px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),"View Bill"]})})})})]},s.id))})]})}),a.length>0&&e.jsx("div",{className:"border-t border-gray-300 px-4 py-3 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold",children:a.length})," bill(s)",l&&" (filtered)"]}),e.jsxs("div",{className:"flex gap-6 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsxs("span",{className:"text-gray-600",children:["Paid: ",r.paid]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsxs("span",{className:"text-gray-600",children:["Unpaid: ",r.unpaid]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Total: ₹",r.totalAmount.toFixed(2)]})]})]})]})})]})]})})}const z=()=>e.jsx(L,{requiredRole:["admin","cashier"],children:e.jsx(E,{})});export{z as component};
