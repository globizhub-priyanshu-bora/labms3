import{R as re,r,j as e,B as a,b as R,X as D,d as Q,e as ae,f as le,h as ce,i as ie,k as de}from"./main-vMwdSAIQ.js";import{u as C}from"./index.esm-D6iZMFZI.js";import{L as ne}from"./Layout-CaoylRxh.js";import{L as x}from"./label-CKz-pXdu.js";import{P as xe}from"./plus-DVRvYTQD.js";import{S as oe}from"./search-DGwleQtH.js";import{S as me,T as he}from"./trash-2-CQB2gHtZ.js";import"./user-C1TGoub_.js";function ve(){const k=re.useLoaderData(),[U,V]=r.useState(k?.tests?.data||[]),[m,pe]=r.useState(k?.parameters?.data||[]),[$,h]=r.useState(!1),[z,p]=r.useState(!1),[N,E]=r.useState(null),[y,w]=r.useState(""),[X,u]=r.useState([]),[n,g]=r.useState(!1),[c,d]=r.useState([]),[S,i]=r.useState("0.00"),[o,A]=r.useState(""),[q,I]=r.useState([]),{register:L,handleSubmit:G,reset:H,setValue:M,formState:{errors:b,isSubmitting:B}}=C(),{register:F,handleSubmit:J,reset:K,setValue:ye,formState:{errors:f,isSubmitting:O}}=C(),{register:W,handleSubmit:Y}=C();r.useEffect(()=>{if(o){const s=m.filter(t=>t.name.toLowerCase().includes(o.toLowerCase()));I(s)}else I(m)},[o,m]),r.useEffect(()=>{(async()=>{if(c.length===0){i("0.00");return}try{const t=await Q({data:{parameterIds:c}});t.success&&(i(t.totalPrice),M("price",t.totalPrice))}catch(t){console.error("Error calculating price:",t)}})()},[c,M]);const v=async()=>{try{const s=await de({data:{limit:100,offset:0,sortBy:"name",sortOrder:"asc"}});s.success&&V(s.data)}catch(s){console.error("Error loading tests:",s)}},j=s=>{d(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},Z=async s=>{try{(await ce({data:{name:s.name,price:s.price,parameterIds:c}})).success&&(h(!1),H(),d([]),i("0.00"),await v())}catch(t){console.error("Error adding test:",t),alert(t instanceof Error?t.message:"Failed to add test")}},P=async s=>{if(!s.query.trim()){u([]),g(!1);return}try{const t=await ae({data:{query:s.query,limit:50,offset:0}});t.success&&(u(t.data),g(!0))}catch(t){console.error("Error searching tests:",t)}},_=async s=>{E(s);const t=s.metadata?.parameterIds||[];if(d(t),K({name:s.name,price:s.price}),t.length>0)try{const l=await Q({data:{parameterIds:t}});l.success&&i(l.totalPrice)}catch(l){console.error("Error calculating price:",l)}p(!0)},ee=async s=>{if(N)try{(await ie({data:{id:N.id,name:s.name,price:s.price,parameterIds:c}})).success&&(p(!1),E(null),d([]),i("0.00"),await v(),n&&await P({query:y}))}catch(t){console.error("Error updating test:",t),alert(t instanceof Error?t.message:"Failed to update test")}},se=async s=>{if(confirm("Are you sure you want to delete this test?"))try{(await le({data:{id:s}})).success&&(await v(),n&&await P({query:y}))}catch(t){console.error("Error deleting test:",t),alert("Failed to delete test")}},T=n?X:U,te=s=>{const t=s.metadata?.parameterIds||[];return m.filter(l=>t.includes(l.id))};return e.jsx(ne,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white border border-gray-300 mb-4 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Test Bundles Management"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[T.length," test(s) ",n&&`for "${y}"`]})]}),e.jsxs(a,{onClick:()=>h(!0),className:"px-4 py-2",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Test"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Search Tests"}),e.jsxs("form",{onSubmit:Y(P),children:[e.jsx("input",{type:"text",placeholder:"Search...",...W("query"),onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-2"}),e.jsxs("button",{type:"submit",className:"w-full px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:[e.jsx(oe,{className:"w-4 h-4 inline mr-1"}),"Search"]})]}),n&&e.jsx(a,{onClick:()=>{g(!1),u([]),w("")},className:"w-full mt-2 px-3 py-2 text-sm",children:"Clear Search"})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"bg-white border border-gray-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Test Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Parameters"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Price (₹)"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-12 text-center",children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No tests found"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:['No results for "',y,'"']}),e.jsx(a,{onClick:()=>{g(!1),u([]),w("")},className:"mt-3 px-4 py-2 text-sm",children:"Clear Search"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No tests available"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:'Click "Add Test" to create one'})]})})}):T.map(s=>{const t=te(s);return e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.length>0?t.map(l=>l.name).join(", "):"-"}),e.jsxs("td",{className:"px-4 py-3 text-gray-900",children:["₹",s.price]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(a,{onClick:()=>_(s),className:"px-2 py-1",title:"Edit",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(a,{onClick:()=>se(s.id),variant:"destructive",className:"px-2 py-1",title:"Delete",children:e.jsx(he,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white border border-gray-400 max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Test Bundle"}),e.jsx(a,{variant:"destructive",onClick:()=>{h(!1),d([]),i("0.00")},className:"p-1",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:G(Z),className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Test Name *"}),e.jsx("input",{type:"text",...L("name",{required:"Test name is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),b.name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:b.name.message})]}),e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Price (₹) *"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"text",...L("price",{required:"Price is required"}),className:"flex-1 px-3 py-2 border border-gray-300 text-sm",placeholder:`Calculated: ${S}`})}),b.price&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:b.price.message}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Calculated: ₹",S]})]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4",children:[e.jsxs(x,{className:"block text-sm font-medium text-gray-900 mb-2",children:["Select Parameters (",c.length," selected)"]}),e.jsx("input",{type:"text",placeholder:"Search parameters...",value:o,onChange:s=>A(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-3"}),e.jsx("div",{className:"border border-gray-300 max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900 w-12",children:"Select"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Parameter"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-900",children:"Price"})]})}),e.jsx("tbody",{children:q.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>j(s.id),children:[e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>j(s.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.name}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:s.unit||"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:s.price?`₹${s.price}`:"-"})]},s.id))})]})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(a,{type:"button",variant:"destructive",onClick:()=>{h(!1),d([]),i("0.00")},className:"flex-1 px-3 py-2 text-sm",children:"Cancel"}),e.jsx(a,{type:"submit",disabled:B,className:"flex-1 px-3 py-2 text-sm",children:B?"Adding...":"Add Test"})]})]})]})}),z&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white border border-gray-400 max-w-3xl w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Edit Test Bundle"}),e.jsx(a,{onClick:()=>{p(!1),d([]),i("0.00")},className:"p-1 bg-white border border-gray-400",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:J(ee),className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Test Name *"}),e.jsx("input",{type:"text",...F("name",{required:"Test name is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),f.name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.name.message})]}),e.jsxs("div",{children:[e.jsx(x,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Price (₹) *"}),e.jsx("input",{type:"text",...F("price",{required:"Price is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),f.price&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:f.price.message}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Calculated: ₹",S]})]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4",children:[e.jsxs(x,{className:"block text-sm font-medium text-gray-900 mb-2",children:["Select Parameters (",c.length," selected)"]}),e.jsx("input",{type:"text",placeholder:"Search parameters...",value:o,onChange:s=>A(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-3"}),e.jsx("div",{className:"border border-gray-300 max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900 w-12",children:"Select"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Parameter"}),e.jsx("th",{className:"px-3 py-2 text-left font-semibold text-gray-900",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-right font-semibold text-gray-900",children:"Price"})]})}),e.jsx("tbody",{children:q.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>j(s.id),children:[e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>j(s.id),className:"w-4 h-4"})}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.name}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:s.unit||"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:s.price?`₹${s.price}`:"-"})]},s.id))})]})})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(a,{type:"button",onClick:()=>{p(!1),d([]),i("0.00")},className:"flex-1 px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:"Cancel"}),e.jsx(a,{type:"submit",disabled:O,className:"flex-1 px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:O?"Updating...":"Update Test"})]})]})]})})]})})}export{ve as component};
