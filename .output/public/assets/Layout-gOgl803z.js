import{a7 as L,c as j,w as f,r as i,j as e,g as k,a8 as C,t as u,B as p,X as A}from"./main-U2sX-pZG.js";function M(a){return L({select:s=>s.location})}const D=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],S=j("chevron-down",D);const E=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],y=j("log-out",E);const _=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],$=j("menu",_);function P(a,s){return a==="admin"||a==="Admin"||!s?!0:(Array.isArray(s)?s:[s]).some(d=>a.toLowerCase()===d.toLowerCase())}const w=i.createContext({user:null,loading:!0,logout:async()=>{}}),U=()=>i.useContext(w),B=({children:a,requiredRole:s})=>{const r=f(),[d,n]=i.useState(null),[m,l]=i.useState(!0),[o,x]=i.useState(null);i.useEffect(()=>{(async()=>{try{const h=await k();if(!h.success||!h.user){l(!1),r({to:"/"});return}const g=h.user;if(!g.hasCompletedSetup||!g.labId){l(!1),r({to:"/lab-setup"});return}if(s&&!P(g.role,s)){x(`Access denied. This page requires ${Array.isArray(s)?s.join(", "):s} role.`),l(!1);return}n(g),l(!1)}catch(h){console.error("Auth check error:",h),x("Failed to verify authentication"),l(!1),r({to:"/"})}})()},[r,s]);const b=async()=>{try{(await C({})).success?(u.success("Logged out successfully"),n(null),r({to:"/"})):u.error("Failed to logout")}catch(t){console.error("Logout error:",t),u.error(t instanceof Error?t.message:"Failed to logout"),n(null),r({to:"/"})}};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"text-center max-w-md",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:o}),e.jsx("button",{onClick:()=>r({to:"/dashboard"}),className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded",children:"Go to Dashboard"})]})})}):e.jsx(w.Provider,{value:{user:d,loading:m,logout:b},children:a})},N=[{to:"/patients/register",label:"Patient Registration"},{to:"/bills/$id",label:"Bills"},{to:"/tests",label:"Tests"},{to:"/test-parameters",label:"Parameters"},{to:"/doctors",label:"Doctors"},{to:"/lab-management",label:"Lab Management"}];function T(){const a=f(),s=M(),{user:r,logout:d}=U(),[n,m]=i.useState(!1),[l,o]=i.useState(!1),x=async()=>{try{const t=await d();u.success("Logged out successfully"),setTimeout(()=>{window.location.href="/login"},500)}catch(t){console.error("Logout error:",t),u.error("Logout failed, redirecting..."),setTimeout(()=>{window.location.href="/login"},1e3)}},b=s.pathname==="/lab-management";return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"L"})}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Lab Management"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Professional Healthcare Lab"})]})]}),e.jsx("div",{className:"hidden lg:flex items-center gap-1",children:N.map(t=>e.jsx(v,{to:t.to,active:s.pathname===t.to,children:t.label},t.to))}),e.jsxs("div",{className:"hidden lg:flex items-center gap-4",children:[e.jsxs("div",{className:"text-right pr-4 border-r border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r?.name}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:r?.role})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(p,{onClick:()=>m(t=>!t),className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-md flex items-center gap-1",children:["More",e.jsx(S,{className:`w-4 h-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white border-2 border-gray-300 rounded-lg shadow-2xl py-3 z-50 space-y-1",children:[r?.isAdmin&&e.jsx(c,{onClick:()=>{m(!1),a({to:"/admin/user-management"})},children:"ðŸ‘¤ User Management"}),e.jsx(c,{onClick:()=>{m(!1),a({to:"/dashboard"})},children:"ðŸ“Š Dashboard"}),r?.isAdmin&&e.jsx(c,{onClick:()=>{m(!1),a({to:"/lab-details"})},children:"ðŸ¥ Lab Details"}),e.jsx("div",{className:"border-t border-gray-300 my-2"}),e.jsxs(c,{onClick:x,danger:!0,children:[e.jsx(y,{className:"w-4 h-4 mr-2 inline"}),"Logout"]})]})]})]}),e.jsx(p,{onClick:()=>o(t=>!t),className:"lg:hidden p-2 text-gray-700 rounded-md",children:l?e.jsx(A,{className:"w-6 h-6"}):e.jsx($,{className:"w-6 h-6"})})]})})}),b&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Lab Information"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Name: Your Laboratory | Registration: LAB-12345"})]})})})}),l&&e.jsx("div",{className:"lg:hidden bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-2 space-y-1",children:[N.map(t=>e.jsx(v,{to:t.to,onClick:()=>o(!1),active:s.pathname===t.to,children:t.label},t.to)),e.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2 space-y-1",children:[r?.isAdmin&&e.jsx(c,{onClick:()=>{o(!1),a({to:"/admin/user-management"})},children:"User Management"}),e.jsx(c,{onClick:()=>{o(!1),a({to:"/dashboard"})},children:"Dashboard"}),r?.isAdmin&&e.jsx(c,{onClick:()=>{o(!1),a({to:"/lab-details"})},children:"Lab Details"}),e.jsxs(c,{onClick:()=>{o(!1),x()},danger:!0,children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]})})]})}function v({to:a,active:s,children:r,onClick:d}){const n=f();return e.jsx("button",{onClick:()=>{d?.(),n({to:a})},className:`px-4 py-2 text-sm font-semibold rounded-md transition-all ${s?"bg-blue-600 text-white shadow-md":"text-gray-900 bg-gray-100"}`,children:r})}function c({onClick:a,children:s,danger:r}){return e.jsx("button",{type:"button",onClick:a,className:`w-full text-left px-4 py-3 text-sm font-medium rounded-md transition-all ${r?"text-red-600 bg-red-50 hover:bg-red-100":"text-gray-900 bg-gray-50 hover:bg-gray-100"}`,children:s})}const I=({children:a,requiredRole:s})=>e.jsx(B,{requiredRole:s,children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(T,{}),e.jsx("main",{children:a})]})});export{I as L,U as u};
