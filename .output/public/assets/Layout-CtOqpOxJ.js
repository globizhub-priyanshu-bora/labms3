import{c as d,u as N,r as c,j as e,g as k,T as g,B as b,X as M,a5 as A}from"./main-Cf6GnPUP.js";import{U as f,A as C}from"./user-DAVMjCJ9.js";const L=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],_=d("flask-conical",L);const P=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],y=d("layout-dashboard",P);const I=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],U=d("menu",I);const $=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],j=d("power",$);const S=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],D=d("receipt",S);const T=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],z=d("test-tube",T);function E(t,a){return t==="admin"||t==="Admin"||!a?!0:(Array.isArray(a)?a:[a]).some(i=>t.toLowerCase()===i.toLowerCase())}const v=c.createContext({user:null,loading:!0}),B=()=>c.useContext(v),V=({children:t,requiredRole:a})=>{const o=N(),[i,x]=c.useState(null),[h,l]=c.useState(!0),[r,m]=c.useState(null);return c.useEffect(()=>{(async()=>{try{const s=await k();if(!s.success||!s.user){l(!1),o({to:"/"});return}const n=s.user;if(!n.hasCompletedSetup||!n.labId){l(!1),o({to:"/lab-setup"});return}if(a&&!E(n.role,a)){m(`Access denied. This page requires ${Array.isArray(a)?a.join(", "):a} role.`),l(!1);return}x(n),l(!1)}catch(s){console.error("Auth check error:",s),m("Failed to verify authentication"),l(!1),o({to:"/"})}})()},[o,a]),h?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"text-center max-w-md",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:r}),e.jsx("button",{onClick:()=>o({to:"/dashboard"}),className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded",children:"Go to Dashboard"})]})})}):e.jsx(v.Provider,{value:{user:i,loading:h},children:t})},F=()=>{const{user:t}=B(),a=N(),[o,i]=c.useState(!1),[x,h]=c.useState(!1),l=async()=>{try{await A(),a({to:"/"})}catch(s){console.error("Logout error:",s),a({to:"/"})}};if(!t)return null;const r=(s,n)=>{if(t.isAdmin)return!0;const p=t.permissions||{};if(p[s]?.[n]===!0)return!0;const w=s.replace(/s$/,"");return p[w]?.[n]===!0||n==="read"&&p[s]?.view===!0},u=(()=>{const s=[];return t.isAdmin?s.push({to:"/admin/dashboard",label:"Admin Dashboard",icon:y}):s.push({to:"/dashboard",label:"Dashboard",icon:y}),(r("patients","create")||r("patient","create"))&&s.push({to:"/patients/register",label:"Register Patient",icon:f}),(r("tests","view")||r("tests","read")||r("test","read"))&&s.push({to:"/tests/",label:"Tests",icon:z}),(r("parameters","view")||r("parameters","read")||r("test_parameter","read"))&&s.push({to:"/test-parameters/",label:"Parameters",icon:C}),(r("bills","view")||r("bills","create")||r("bill","read"))&&s.push({to:"/bills/$id",label:"Bills",icon:D}),s.push({to:"/lab-management",label:"Lab Management",icon:y}),s})();return e.jsx("nav",{className:"bg-white border-b border-gray-300 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(g,{to:t.isAdmin?"/admin/dashboard":"/dashboard",className:"flex items-center gap-2 group",children:[e.jsx("div",{className:"bg-black text-white p-2 rounded-lg transition-colors",children:e.jsx(_,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xl font-bold text-black hidden sm:inline",children:"GlobPathology"})]}),e.jsx("div",{className:"hidden lg:flex items-center gap-1",children:u.map(s=>{const n=s.icon;return e.jsxs(g,{to:s.to,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 rounded-md transition-colors",activeProps:{className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-black rounded-md"},children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.to)})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden md:flex items-center relative",children:[e.jsxs("button",{onClick:()=>h(!x),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:text-black hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-black text-white flex items-center justify-center font-semibold text-sm",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"hidden sm:inline max-w-32 truncate text-gray-900",children:t.name})]}),x&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-300 py-1 top-full z-50",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.email}),e.jsx("p",{className:"text-xs text-black font-medium mt-1",children:t.role})]}),e.jsxs(b,{onClick:()=>{h(!1),l()},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Logout"]})]})]}),e.jsx(b,{onClick:()=>i(!o),className:"lg:hidden p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:o?e.jsx(M,{className:"w-6 h-6"}):e.jsx(U,{className:"w-6 h-6"})})]})]}),o&&e.jsx("div",{className:"lg:hidden border-t border-gray-300 py-4 bg-white",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 rounded-lg mb-2 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-black p-2 rounded-full",children:e.jsx(f,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.role})]})]})}),u.map(s=>{const n=s.icon;return e.jsxs(g,{to:s.to,onClick:()=>i(!1),className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition-colors",activeProps:{className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-white bg-black rounded-lg"},children:[e.jsx(n,{className:"w-5 h-5"}),s.label]},s.to)}),e.jsxs(b,{onClick:()=>{i(!1),l()},className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors mt-2 w-full",children:[e.jsx(j,{className:"w-5 h-5"}),"Logout"]})]})})]})})},O=({children:t,requiredRole:a})=>e.jsx(V,{requiredRole:a,children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(F,{}),e.jsx("main",{children:t})]})});export{O as L,B as u};
