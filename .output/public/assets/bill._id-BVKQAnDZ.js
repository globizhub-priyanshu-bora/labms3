import{j as e,a3 as j,u,b as N,B as l}from"./main-Cf6GnPUP.js";import{L as f}from"./Layout-CtOqpOxJ.js";import{A as w}from"./arrow-left-gKx5FcEr.js";import{P as v}from"./printer-92dAs3aE.js";import{D as A}from"./download-CpOXaiga.js";import"./user-DAVMjCJ9.js";function T(){const n=j.useLoaderData(),x=u();if(!n.success||!n.data)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-700 mb-4",children:"Bill not found"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:n.error||"Unable to load the requested bill"}),e.jsx(l,{onClick:()=>x({to:"/lab-management"}),children:"Back to Lab Management"})]})});const{bill:a,patient:s,tests:i}=n.data,h=()=>{const t=document.getElementById("bill-print-content");if(!t)return;const r=window.open("","","width=900,height=700");r&&(r.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Bill - ${a.invoiceNumber}</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: Arial, sans-serif; }
            @page { size: A4; margin: 15mm; }
            @media print { body { margin: 0; } }
            .container { width: 100%; max-width: 800px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 20px; }
            .lab-name { font-size: 20px; font-weight: bold; }
            .bill-title { font-size: 16px; font-weight: bold; margin-top: 10px; }
            .section { margin-bottom: 15px; }
            .section-title { font-weight: bold; border-bottom: 1px solid #000; margin-bottom: 5px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .text-right { text-align: right; }
            .total-row { font-weight: bold; }
            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
            .amount-words { margin: 10px 0; font-style: italic; }
          </style>
        </head>
        <body>
          ${t.innerHTML}
        </body>
      </html>
    `),r.document.close(),r.print())},g=t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-",b=t=>t?new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"-",o=parseFloat(a.totalAmount),d=parseFloat(a.discount||"0"),c=parseFloat(a.tax||"0"),m=o*d/100,p=(o-m)*c/100,y=parseFloat(a.finalAmount);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs(l,{onClick:()=>x({to:"/lab-management"}),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:h,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Print"]}),e.jsxs(l,{onClick:()=>{const t=document.getElementById("bill-print-content");if(t){const r=document.createElement("a");r.href="data:text/html,"+encodeURIComponent(t.innerHTML),r.download=`bill-${a.invoiceNumber}.html`,r.click()}},className:"px-4 py-2 bg-green-600 hover:bg-green-700",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Download"]})]})]}),e.jsxs("div",{id:"bill-print-content",className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[e.jsxs("div",{className:"text-center mb-8 border-b border-gray-300 pb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"GlobPathology"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Professional Laboratory Management System"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mt-4",children:"BILL / INVOICE"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"BILL INFORMATION"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Invoice Number:"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.invoiceNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:g(a.createdAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{className:"font-medium text-gray-900",children:b(a.createdAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-semibold px-2 py-1 rounded text-xs ${a.isPaid?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.isPaid?"PAID":"UNPAID"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"PATIENT INFORMATION"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("p",{className:"font-medium text-gray-900",children:s?.name||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("p",{className:"font-medium text-gray-900",children:s?.phoneNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Age/Gender:"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s?.age&&`${s.age} years`,s?.age&&s?.gender?" / ":"",s?.gender]})]}),s?.addressLine1&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Address:"}),e.jsx("p",{className:"font-medium text-gray-900",children:[s.addressLine1,s.city,s.state,s.pincode].filter(Boolean).join(", ")})]})]})]})]}),i&&i.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"TESTS PERFORMED"}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border border-gray-300",children:"Test Name"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-900 border border-gray-300",children:"Status"})]})}),e.jsx("tbody",{children:i.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-gray-900 border border-gray-300",children:t.test?.name||"Unknown Test"}),e.jsx("td",{className:"px-3 py-2 text-center text-sm border border-gray-300",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${t.patientTest.status.toLowerCase()==="completed"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:t.patientTest.status.toUpperCase()})})]},r))})]})]}),e.jsx("div",{className:"max-w-xs ml-auto mb-8",children:e.jsx("table",{className:"w-full border-collapse",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-gray-600",children:"Total Amount:"}),e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 text-right",children:["₹",o.toFixed(2)]})]}),d>0&&e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-600",children:["Discount (",d,"%):"]}),e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 text-right",children:["-₹",m.toFixed(2)]})]}),c>0&&e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-600",children:["Tax (",c,"%):"]}),e.jsxs("td",{className:"px-3 py-2 text-sm font-medium text-gray-900 text-right",children:["₹",p.toFixed(2)]})]}),e.jsxs("tr",{className:"bg-blue-50",children:[e.jsx("td",{className:"px-3 py-3 text-sm font-bold text-gray-900",children:"Final Amount:"}),e.jsxs("td",{className:"px-3 py-3 text-lg font-bold text-gray-900 text-right",children:["₹",y.toFixed(2)]})]})]})})}),e.jsxs("div",{className:"border-t border-gray-300 pt-6 text-center text-xs text-gray-600",children:[e.jsx("p",{children:"This is an electronically generated bill and does not require a signature."}),e.jsx("p",{className:"mt-2",children:"Thank you for choosing GlobPathology. We appreciate your trust in our services."})]})]})]})})}const F=()=>e.jsx(f,{requiredRole:["admin","cashier","lab_tech"],children:e.jsx(T,{})});export{F as component};
