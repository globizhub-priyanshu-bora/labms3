import{c as m,u as A,r as d,j as e,g as L,T as h,B as j,X as U,a5 as $}from"./main-DVv88kkj.js";import{U as N,A as D}from"./user-BQVLwmK3.js";const P=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],v=m("chevron-down",P);const S=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],I=m("flask-conical",S);const z=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],y=m("layout-dashboard",z);const T=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],E=m("menu",T);const B=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],w=m("power",B);const F=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],H=m("receipt",F);const V=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],k=m("settings",V);const G=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],O=m("test-tube",G);const X=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],M=m("users",X);function Z(t,a){return t==="admin"||t==="Admin"||!a?!0:(Array.isArray(a)?a:[a]).some(l=>t.toLowerCase()===l.toLowerCase())}const C=d.createContext({user:null,loading:!0}),J=()=>d.useContext(C),K=({children:t,requiredRole:a})=>{const o=A(),[l,b]=d.useState(null),[p,r]=d.useState(!0),[c,g]=d.useState(null);return d.useEffect(()=>{(async()=>{try{const u=await L();if(!u.success||!u.user){r(!1),o({to:"/"});return}const x=u.user;if(!x.hasCompletedSetup||!x.labId){r(!1),o({to:"/lab-setup"});return}if(a&&!Z(x.role,a)){g(`Access denied. This page requires ${Array.isArray(a)?a.join(", "):a} role.`),r(!1);return}b(x),r(!1)}catch(u){console.error("Auth check error:",u),g("Failed to verify authentication"),r(!1),o({to:"/"})}})()},[o,a]),p?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):c?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"text-center max-w-md",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-red-700",children:c}),e.jsx("button",{onClick:()=>o({to:"/dashboard"}),className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded",children:"Go to Dashboard"})]})})}):e.jsx(C.Provider,{value:{user:l,loading:p},children:t})},Q=()=>{const{user:t}=J(),a=A(),[o,l]=d.useState(!1),[b,p]=d.useState(!1),[r,c]=d.useState(!1),g=async()=>{try{await $(),a({to:"/"})}catch(s){console.error("Logout error:",s),a({to:"/"})}};if(!t)return null;const n=(s,i)=>{if(t.isAdmin)return!0;const f=t.permissions||{};if(f[s]?.[i]===!0)return!0;const _=s.replace(/s$/,"");return f[_]?.[i]===!0||i==="read"&&f[s]?.view===!0},x=(()=>{const s=[];return t.isAdmin||s.push({to:"/dashboard",label:"Dashboard",icon:y}),(n("patients","create")||n("patient","create"))&&s.push({to:"/patients/register",label:"Register Patient",icon:N}),(n("tests","view")||n("tests","read")||n("test","read"))&&s.push({to:"/tests/",label:"Tests",icon:O}),(n("parameters","view")||n("parameters","read")||n("test_parameter","read"))&&s.push({to:"/test-parameters/",label:"Parameters",icon:D}),(n("bills","view")||n("bills","create")||n("bill","read"))&&s.push({to:"/bills/$id",label:"Bills",icon:H}),s.push({to:"/lab-management",label:"Lab Management",icon:y}),s})();return e.jsx("nav",{className:"bg-white border-b border-gray-300 sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(h,{to:t.isAdmin?"/admin/dashboard":"/dashboard",className:"flex items-center gap-2 group",children:[e.jsx("div",{className:"bg-black text-white p-2 rounded-lg transition-colors",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xl font-bold text-black hidden sm:inline",children:"GlobPathology"})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-1",children:[t.isAdmin?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>c(!r),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 rounded-md transition-colors hover:bg-gray-100",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"User Management"}),e.jsx(v,{className:`w-4 h-4 transition-transform ${r?"rotate-180":""}`})]}),r&&e.jsxs("div",{className:"absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-300 py-1 z-50",children:[e.jsxs(h,{to:"/dashboard",onClick:()=>c(!1),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(h,{to:"/admin/dashboard",onClick:()=>c(!1),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"User Management"})]})]})]}):x.map(s=>{const i=s.icon;return e.jsxs(h,{to:s.to,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 rounded-md transition-colors",activeProps:{className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-black rounded-md"},children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.to)}),!t.isAdmin&&x.map(s=>{const i=s.icon;return e.jsxs(h,{to:s.to,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 rounded-md transition-colors",activeProps:{className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-black rounded-md"},children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.to)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden md:flex items-center relative",children:[e.jsxs("button",{onClick:()=>p(!b),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:text-black hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-black text-white flex items-center justify-center font-semibold text-sm",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"hidden sm:inline max-w-32 truncate text-gray-900",children:t.name})]}),b&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-300 py-1 top-full z-50",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.email}),e.jsx("p",{className:"text-xs text-black font-medium mt-1",children:t.role})]}),e.jsxs(j,{onClick:()=>{p(!1),g()},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(w,{className:"w-4 h-4"}),"Logout"]})]})]}),e.jsx(j,{onClick:()=>l(!o),className:"lg:hidden p-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:o?e.jsx(U,{className:"w-6 h-6"}):e.jsx(E,{className:"w-6 h-6"})})]})]}),o&&e.jsx("div",{className:"lg:hidden border-t border-gray-300 py-4 bg-white",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 rounded-lg mb-2 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-black p-2 rounded-full",children:e.jsx(N,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.role})]})]})}),t.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!r),className:"flex items-center justify-between px-4 py-3 text-sm font-medium text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"User Management"})]}),e.jsx(v,{className:`w-4 h-4 transition-transform ${r?"rotate-180":""}`})]}),r&&e.jsxs("div",{className:"pl-4 space-y-2",children:[e.jsxs(h,{to:"/dashboard",onClick:()=>{c(!1),l(!1)},className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition-colors ml-4 border-l-2 border-gray-300",children:[e.jsx(y,{className:"w-5 h-5"}),"Dashboard"]}),e.jsxs(h,{to:"/admin/dashboard",onClick:()=>{c(!1),l(!1)},className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition-colors ml-4 border-l-2 border-gray-300",children:[e.jsx(M,{className:"w-5 h-5"}),"User Management"]})]})]}),!t.isAdmin&&x.map(s=>{const i=s.icon;return e.jsxs(h,{to:s.to,onClick:()=>l(!1),className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition-colors",activeProps:{className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-white bg-black rounded-lg"},children:[e.jsx(i,{className:"w-5 h-5"}),s.label]},s.to)}),e.jsxs(j,{onClick:()=>{l(!1),g()},className:"flex items-center gap-3 px-4 py-3 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors mt-2 w-full",children:[e.jsx(w,{className:"w-5 h-5"}),"Logout"]})]})})]})})},q=({children:t,requiredRole:a})=>e.jsx(K,{requiredRole:a,children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("main",{children:t})]})});export{q as L,M as U,J as u};
