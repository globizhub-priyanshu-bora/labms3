import{c as J,j as e,v as K,w as W,r as x,F as E,B as c,x as Z,X as R,L as i,y as ee,t as p,z as se,A as te}from"./main-U2sX-pZG.js";import{L as re}from"./Layout-gOgl803z.js";import{U as ae,T as le}from"./users-0syvr9LY.js";import{C as ne}from"./calendar-BQQqP266.js";import{S as ie}from"./search-C16oIlKW.js";import{U as de}from"./user-plus-Ba1wm7Ku.js";import{S as O,T as ce}from"./trash-2-DVrQfetj.js";const oe=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],M=J("funnel",oe);function xe(){const L=K.useLoaderData(),A=W(),[u,C]=x.useState(L?.data||[]),[o,h]=x.useState(L?.data||[]),[d,f]=x.useState([]),[$,y]=x.useState(!1),[Q,b]=x.useState(!1),[j,N]=x.useState(null),[P,F]=x.useState({}),[U,q]=x.useState(""),[k,D]=x.useState(!1),[a,g]=x.useState({searchQuery:"",gender:"",city:"",state:"",dateFrom:"",dateTo:"",ageMin:"",ageMax:""}),[n,m]=x.useState({name:"",age:void 0,gender:"",phoneNumber:void 0,addressLine1:"",city:"",state:"",country:"",pincode:void 0}),T=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-",I=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",B=async()=>{D(!0);try{const s=await ee({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});s.success&&(C(s.data),h(s.data),F({}),g({searchQuery:"",gender:"",city:"",state:"",dateFrom:"",dateTo:"",ageMin:"",ageMax:""}),f([]))}catch(s){console.error("Error refreshing:",s),p.error("Failed to refresh data")}finally{D(!1)}},z=s=>{f(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},G=()=>{d.length===o.length?f([]):f(o.map(s=>s.id))},Y=s=>{s.preventDefault();let t=[...u];if(a.searchQuery.trim()){const r=a.searchQuery.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(r)||l.phoneNumber?.toString().includes(r)||l.city?.toLowerCase().includes(r)||l.state?.toLowerCase().includes(r))}if(a.gender&&(t=t.filter(r=>r.gender?.toLowerCase()===a.gender.toLowerCase())),a.city.trim()&&(t=t.filter(r=>r.city?.toLowerCase().includes(a.city.toLowerCase()))),a.state.trim()&&(t=t.filter(r=>r.state?.toLowerCase().includes(a.state.toLowerCase()))),a.ageMin){const r=parseInt(a.ageMin);t=t.filter(l=>l.age!==null&&l.age>=r)}if(a.ageMax){const r=parseInt(a.ageMax);t=t.filter(l=>l.age!==null&&l.age<=r)}if(a.dateFrom){const r=new Date(a.dateFrom);t=t.filter(l=>l.createdAt?new Date(l.createdAt)>=r:!1)}if(a.dateTo){const r=new Date(a.dateTo);r.setHours(23,59,59,999),t=t.filter(l=>l.createdAt?new Date(l.createdAt)<=r:!1)}h(t),F(a),y(!1)},S=()=>{g({searchQuery:"",gender:"",city:"",state:"",dateFrom:"",dateTo:"",ageMin:"",ageMax:""}),h(u),F({})},_=s=>{N(s),m({name:s.name,age:s.age||void 0,gender:s.gender||"",phoneNumber:s.phoneNumber||void 0,addressLine1:s.addressLine1||"",city:s.city||"",state:s.state||"",country:s.country||"",pincode:s.pincode||void 0}),b(!0)},H=()=>{if(d.length===0){p.error("Please select a patient to edit");return}if(d.length>1){p.error("Please select only one patient to edit");return}const s=o.find(t=>t.id===d[0]);s&&_(s)},V=async s=>{if(s.preventDefault(),!!j)try{const t=await te({data:{id:j.id,...n}});if(t.success){const r=u.map(l=>l.id===j.id?t.data:l);C(r),h(r),b(!1),N(null),f([]),p.error("Patient updated successfully!")}}catch(t){console.error("Error updating patient:",t),p.error(t instanceof Error?t.message:"Failed to update patient")}},X=async()=>{if(d.length===0){p.error("Please select at least one patient to delete");return}const s=`Are you sure you want to delete ${d.length} patient(s)? This action cannot be undone.`;if(confirm(s))try{const t=await se({data:{ids:d}});if(t.success){const r=u.filter(l=>!d.includes(l.id));C(r),h(r),f([]),alert(t.message)}}catch(t){console.error("Error deleting patients:",t),p.error(t instanceof Error?t.message:"Failed to delete patients")}},v=Object.values(P).some(s=>s&&s!==""),w=({icon:s,label:t,value:r,color:l})=>e.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${l}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:t}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:r})]}),e.jsx("div",{className:`p-3 rounded-lg ${l.split(" ")[0]} bg-opacity-10`,children:e.jsx(s,{className:`w-6 h-6 ${l.split(" ")[1]}`})})]})});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(w,{icon:ae,label:"Total Patients",value:u.length,color:"border-l-4 border-blue-500"}),e.jsx(w,{icon:E,label:"Total Bills",value:o.length,color:"border-l-4 border-green-500"}),e.jsx(w,{icon:le,label:"Active Records",value:o.length,color:"border-l-4 border-purple-500"}),e.jsx(w,{icon:ne,label:"This Month",value:u.filter(s=>{if(!s.createdAt)return!1;const t=new Date(s.createdAt),r=new Date;return t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()}).length,color:"border-l-4 border-orange-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Manage Patients"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Total Patients: ",e.jsx("span",{className:"font-semibold",children:u.length}),o.length!==u.length&&e.jsxs(e.Fragment,{children:[" • Filtered: ",e.jsx("span",{className:"font-semibold",children:o.length})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg shadow-sm mb-4 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-75 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search patients...",value:U,onChange:s=>{q(s.target.value);const t=s.target.value.toLowerCase();if(!t)h(u);else{const r=u.filter(l=>l.name.toLowerCase().includes(t)||l.phoneNumber?.toString().includes(t)||l.city?.toLowerCase().includes(t)||l.state?.toLowerCase().includes(t));h(r)}},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{onClick:B,disabled:k,className:"px-4 py-2 text-sm",children:[e.jsx(Z,{className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`}),"Refresh"]}),e.jsxs(c,{onClick:()=>A({to:"/patients/register"}),className:"px-4 py-2 text-sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"New Patient"]}),e.jsxs(c,{disabled:d.length===0,onClick:H,className:"px-4 py-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(c,{disabled:d.length===0,onClick:X,variant:"destructive",className:"px-4 py-2 text-sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Delete"]}),e.jsxs(c,{onClick:()=>y(!0),className:`px-4 py-2 text-sm ${v?"bg-blue-700":""}`,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Filter"]})]})]}),v&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active Filters:"}),Object.entries(P).map(([s,t])=>t?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:[s,": ",t]},s):null),e.jsx(c,{onClick:S,variant:"destructive",className:"px-2 py-1 text-xs",children:"Clear All"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-center w-12",children:e.jsx("input",{type:"checkbox",checked:d.length===o.length&&o.length>0,onChange:G,className:"w-4 h-4 rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Lab ID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Patient"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Registered"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(M,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-700 font-medium text-lg",children:"No patients found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:v?"Try adjusting your filters":'Click "New Patient" to register'}),v&&e.jsx(c,{onClick:S,className:"mt-4 px-6 py-2",children:"Clear Filters"})]})})}):o.map(s=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-blue-50 transition-colors ${d.includes(s.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:d.includes(s.id),onChange:()=>z(s.id),className:"w-4 h-4 rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-blue-600",children:s.id.toString().padStart(6,"0")}),e.jsx("div",{className:"text-xs text-gray-500",children:T(s.createdAt)})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[s.age&&`${s.age} Yrs`,s.age&&s.gender&&" • ",s.gender&&`(${s.gender})`]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-gray-700 font-medium",children:I(s.createdAt)}),e.jsx("div",{className:"text-xs text-gray-500",children:T(s.createdAt)})]}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.phoneNumber||"-"}),e.jsxs("td",{className:"px-4 py-3 text-gray-700",children:[s.city||"-",s.city&&s.state&&", ",s.state||""]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex justify-center gap-2",children:e.jsxs(c,{className:"px-3 py-1 text-xs",title:"View Details",onClick:()=>A({to:"/patients/$id",params:{id:s.id.toString()}}),children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"View"]})})})]},s.id))})]})}),o.length>0&&e.jsx("div",{className:"border-t border-gray-300 px-4 py-3 bg-gray-50",children:e.jsx("div",{className:"flex justify-between items-center text-sm",children:e.jsxs("div",{className:"text-gray-600",children:["Showing ",o.length," patient(s)",d.length>0&&` • ${d.length} selected`]})})})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full my-8 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600"}),"Filter Patients"]}),e.jsx(c,{onClick:()=>y(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(R,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:Y,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Search Text"}),e.jsx("input",{type:"text",value:a.searchQuery,onChange:s=>g({...a,searchQuery:s.target.value}),placeholder:"Search by name, phone, city, or state...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Gender"}),e.jsxs("select",{value:a.gender,onChange:s=>g({...a,gender:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"City"}),e.jsx("input",{type:"text",value:a.city,onChange:s=>g({...a,city:s.target.value}),placeholder:"Enter city",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"State"}),e.jsx("input",{type:"text",value:a.state,onChange:s=>g({...a,state:s.target.value}),placeholder:"Enter state",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Age Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",value:a.ageMin,onChange:s=>g({...a,ageMin:s.target.value}),placeholder:"Min age",min:"0",max:"150",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"number",value:a.ageMax,onChange:s=>g({...a,ageMax:s.target.value}),placeholder:"Max age",min:"0",max:"150",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Registration Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-500 mb-1 block",children:"From"}),e.jsx("input",{type:"date",value:a.dateFrom,onChange:s=>g({...a,dateFrom:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-500 mb-1 block",children:"To"}),e.jsx("input",{type:"date",value:a.dateTo,onChange:s=>g({...a,dateTo:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(c,{type:"button",onClick:S,variant:"destructive",className:"flex-1 px-4 py-2",children:"Reset"}),e.jsx(c,{type:"button",onClick:()=>y(!1),className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1 px-4 py-2",children:"Apply Filters"})]})]})]})}),Q&&j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full my-8 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-blue-600"}),"Edit Patient Information"]}),e.jsx(c,{onClick:()=>{b(!1),N(null)},className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(R,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:V,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Full Name *"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>m({...n,name:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Age"}),e.jsx("input",{type:"number",value:n.age||"",onChange:s=>m({...n,age:s.target.value?Number(s.target.value):void 0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Gender"}),e.jsxs("select",{value:n.gender,onChange:s=>m({...n,gender:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Phone Number"}),e.jsx("input",{type:"number",value:n.phoneNumber||"",onChange:s=>m({...n,phoneNumber:s.target.value?Number(s.target.value):void 0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Address"}),e.jsx("input",{type:"text",value:n.addressLine1,onChange:s=>m({...n,addressLine1:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"City"}),e.jsx("input",{type:"text",value:n.city,onChange:s=>m({...n,city:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"State"}),e.jsx("input",{type:"text",value:n.state,onChange:s=>m({...n,state:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Country"}),e.jsx("input",{type:"text",value:n.country,onChange:s=>m({...n,country:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"mb-2",children:"Pincode"}),e.jsx("input",{type:"number",value:n.pincode||"",onChange:s=>m({...n,pincode:s.target.value?Number(s.target.value):void 0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(c,{type:"button",onClick:()=>{b(!1),N(null)},className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700",children:"Update Patient"})]})]})]})})]})}const be=()=>e.jsx(re,{requiredRole:["admin","cashier","lab_tech"],children:e.jsx(xe,{})});export{be as component};
