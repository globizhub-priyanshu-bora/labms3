import{m as Y,r as d,j as e,B as l,b as q,X as Z,n as ee,o as se,p as te,q as re,t as ae}from"./main-BeIBSn2v.js";import{u as S}from"./index.esm-FaYgMAiE.js";import{L as le}from"./Layout-jiilGqhg.js";import{L as i}from"./label-BMEvI5eg.js";import{P as M}from"./plus-WMy_QzTA.js";import{S as ie}from"./search-B7fPuDa6.js";import{S as ce,T}from"./trash-2-C2tnBrVG.js";import"./user-C7G1wQVG.js";function ge(){const V=Y.useLoaderData(),[G,L]=d.useState(V?.data||[]),[a,x]=d.useState(!1),[F,u]=d.useState(!1),[A,P]=d.useState(null),[h,y]=d.useState(""),[D,p]=d.useState([]),[m,g]=d.useState(!1),[c,n]=d.useState([]),{register:j,handleSubmit:O,reset:B,formState:{errors:R,isSubmitting:C}}=S(),{register:b,handleSubmit:I,reset:U,formState:{errors:E,isSubmitting:k}}=S(),{register:$,handleSubmit:Q}=S(),f=async()=>{try{const s=await ae({data:{limit:100,offset:0,sortBy:"name",sortOrder:"asc"}});s.success&&L(s.data)}catch(s){console.error("Error loading parameters:",s)}},z=()=>{n([...c,{ageGroup:"adult",gender:"Any",minAge:void 0,maxAge:void 0,minValue:"",maxValue:""}])},X=s=>{n(c.filter((t,r)=>r!==s))},o=(s,t,r)=>{const w=[...c];w[s]={...w[s],[t]:r},n(w)},_=async s=>{try{(await te({data:{name:s.name,unit:s.unit||void 0,price:s.price||void 0,referenceRanges:c.length>0?c:void 0}})).success&&(x(!1),B(),n([]),await f())}catch(t){console.error("Error adding parameter:",t),alert(t instanceof Error?t.message:"Failed to add parameter")}},N=async s=>{if(!s.query.trim()){p([]),g(!1);return}try{const t=await ee({data:{query:s.query,limit:50,offset:0}});t.success&&(p(t.data),g(!0))}catch(t){console.error("Error searching parameters:",t)}},H=s=>{P(s),U({name:s.name,unit:s.unit||"",price:s.price||""}),n(s.referenceRanges||[]),u(!0)},J=async s=>{if(A)try{(await re({data:{id:A.id,name:s.name,unit:s.unit||void 0,price:s.price||void 0,referenceRanges:c.length>0?c:void 0}})).success&&(u(!1),P(null),n([]),await f(),m&&await N({query:h}))}catch(t){console.error("Error updating parameter:",t),alert(t instanceof Error?t.message:"Failed to update parameter")}},K=async s=>{if(confirm("Are you sure you want to delete this parameter?"))try{(await se({data:{id:s}})).success&&(await f(),m&&await N({query:h}))}catch(t){console.error("Error deleting parameter:",t),alert("Failed to delete parameter")}},v=m?D:G,W=s=>!s||s.length===0?"Not set":`${s.length} range(s)`;return e.jsx(le,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"bg-white border border-gray-300 mb-4 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Test Parameters Management"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[v.length," parameter(s) ",m&&`for "${h}"`]})]}),e.jsxs(l,{onClick:()=>x(!0),className:"px-4 py-2",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Add Parameter"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Search Parameters"}),e.jsxs("form",{onSubmit:Q(N),children:[e.jsx("input",{type:"text",placeholder:"Search...",...$("query"),onChange:s=>y(s.target.value),className:"w-full px-3 py-2 border border-gray-300 text-sm mb-2"}),e.jsxs("button",{type:"submit",className:"w-full px-3 py-2 bg-white border border-gray-400 text-gray-900 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 inline mr-1"}),"Search"]})]}),m&&e.jsx(l,{onClick:()=>{g(!1),p([]),y("")},className:"w-full mt-2 px-3 py-2 text-sm",children:"Clear Search"})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"bg-white border border-gray-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Parameter Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Unit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Reference Ranges"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-900",children:"Price (₹)"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-12 text-center",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No parameters found"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:['No results for "',h,'"']}),e.jsx(l,{onClick:()=>{g(!1),p([]),y("")},className:"mt-3 px-4 py-2 text-sm",children:"Clear Search"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-700 font-medium text-base",children:"No parameters available"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:'Click "Add Parameter" to create one'})]})})}):v.map(s=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.unit||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:e.jsx("span",{className:"text-blue-600 font-medium",children:W(s.referenceRanges)})}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.price?`₹${s.price}`:"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(l,{onClick:()=>H(s),className:"px-2 py-1",title:"Edit",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(l,{onClick:()=>K(s.id),variant:"destructive",className:"px-2 py-1",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})})]},s.id))})]})})})})]})]}),(a||F)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white border border-gray-400 max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Add Test Parameter":"Edit Test Parameter"}),e.jsx(l,{onClick:()=>{a?x(!1):u(!1),n([])},className:"p-1",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:a?O(_):I(J),className:"p-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Parameter Name *"}),e.jsx("input",{type:"text",...a?j("name",{required:"Name is required"}):b("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 text-sm"}),(a?R.name:E.name)&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:(a?R.name:E.name)?.message})]}),e.jsxs("div",{children:[e.jsx(i,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Unit"}),e.jsx("input",{type:"text",...a?j("unit"):b("unit"),className:"w-full px-3 py-2 border border-gray-300 text-sm",placeholder:"mg/dL, mmol/L, etc."})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"block text-sm font-medium text-gray-900 mb-1",children:"Price (₹)"}),e.jsx("input",{type:"text",...a?j("price"):b("price"),className:"w-full px-3 py-2 border border-gray-300 text-sm",placeholder:"150.00"})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx(i,{className:"text-base font-semibold text-gray-900",children:"Reference Ranges (Age & Gender Specific)"}),e.jsxs(l,{type:"button",onClick:z,className:"px-3 py-1 text-sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Add Range"]})]}),c.length===0?e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded p-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:'No reference ranges added. Click "Add Range" to set age and gender-specific ranges.'})}):e.jsx("div",{className:"space-y-3",children:c.map((s,t)=>e.jsxs("div",{className:"border border-gray-300 rounded p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["Range #",t+1]}),e.jsx(l,{type:"button",onClick:()=>X(t),variant:"destructive",className:"px-2 py-1 text-xs",children:e.jsx(T,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Age Group *"}),e.jsxs("select",{value:s.ageGroup,onChange:r=>o(t,"ageGroup",r.target.value),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",children:[e.jsx("option",{value:"child",children:"Child (0-12)"}),e.jsx("option",{value:"teen",children:"Teen (13-19)"}),e.jsx("option",{value:"adult",children:"Adult (20-64)"}),e.jsx("option",{value:"senior",children:"Senior (65+)"}),e.jsx("option",{value:"custom",children:"Custom Age Range"})]})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Gender *"}),e.jsxs("select",{value:s.gender,onChange:r=>o(t,"gender",r.target.value),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",children:[e.jsx("option",{value:"Any",children:"Any"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}),s.ageGroup==="custom"&&e.jsxs("div",{className:"col-span-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Min Age"}),e.jsx("input",{type:"number",value:s.minAge||"",onChange:r=>o(t,"minAge",r.target.value?Number(r.target.value):void 0),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Max Age"}),e.jsx("input",{type:"number",value:s.maxAge||"",onChange:r=>o(t,"maxAge",r.target.value?Number(r.target.value):void 0),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",placeholder:"120"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Min Value *"}),e.jsx("input",{type:"text",value:s.minValue,onChange:r=>o(t,"minValue",r.target.value),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",placeholder:"e.g., 70",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-700 mb-1",children:"Max Value *"}),e.jsx("input",{type:"text",value:s.maxValue,onChange:r=>o(t,"maxValue",r.target.value),className:"w-full px-2 py-2 border border-gray-300 text-sm rounded",placeholder:"e.g., 100",required:!0})]})]})]},t))})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(l,{type:"button",variant:"destructive",onClick:()=>{a?x(!1):u(!1),n([])},className:"flex-1 px-3 py-2 text-sm",children:"Cancel"}),e.jsx(l,{type:"submit",disabled:a?C:k,className:"flex-1 px-3 py-2 text-sm",children:(a?C:k)?"Saving...":a?"Add Parameter":"Update Parameter"})]})]})]})})]})})}export{ge as component};
