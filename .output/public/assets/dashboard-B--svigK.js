import{Q as R,a0 as L,r as c,j as e,B as m,X as q,L as x,a1 as T,a2 as B,a3 as v,a4 as I}from"./main-DKZ1eiYM.js";import{u as M,L as w}from"./Layout-B54LSfe1.js";import{P as O}from"./plus-COP95Qi3.js";import{S as V,T as z}from"./trash-2-Cwax-49T.js";import"./user-ZdgPDPxn.js";function W(){const{user:G}=M(),{showToast:r}=R(),N=L.useLoaderData(),[h,u]=c.useState(N?.data||[]),[b,d]=c.useState("users"),[y,f]=c.useState(null),[g,p]=c.useState(!1),[t,i]=c.useState({name:"",email:"",password:"",role:"",phoneNumber:void 0,permissions:{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}}),U=[{key:"patients",label:"Patients"},{key:"bills",label:"Bills"},{key:"tests",label:"Tests"},{key:"parameters",label:"Parameters"},{key:"doctors",label:"Doctors"},{key:"reports",label:"Reports"},{key:"users",label:"Users"}],k=["view","create","edit","delete"],o=()=>{i({name:"",email:"",password:"",role:"",phoneNumber:void 0,permissions:{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}})},A=()=>{o(),d("add")},C=s=>{f(s),i({name:s.name,email:s.email,password:"",role:s.role,phoneNumber:s.phoneNumber||void 0,permissions:s.permissions||{patients:{view:!1,create:!1,edit:!1,delete:!1},bills:{view:!1,create:!1,edit:!1,delete:!1},tests:{view:!1,create:!1,edit:!1,delete:!1},parameters:{view:!1,create:!1,edit:!1,delete:!1},doctors:{view:!1,create:!1,edit:!1,delete:!1},reports:{view:!1,create:!1,edit:!1,delete:!1},users:{view:!1,create:!1,edit:!1,delete:!1}}}),d("edit")},S=async s=>{if(confirm("Are you sure you want to delete this user?"))try{(await T({data:{id:s}})).success?(u(h.filter(l=>l.id!==s)),r("User deleted successfully","success")):r("Failed to delete user","error")}catch(a){r(a instanceof Error?a.message:"Failed to delete user","error")}},F=async s=>{s.preventDefault(),p(!0);try{if((await B({data:t})).success){const l=await v({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});u(l.data),r("User created successfully","success"),d("users"),o()}else r("Failed to create user","error")}catch(a){r(a instanceof Error?a.message:"Failed to create user","error")}finally{p(!1)}},D=async s=>{if(s.preventDefault(),!!y){p(!0);try{const a={id:y.id,name:t.name,email:t.email,role:t.role,phoneNumber:t.phoneNumber,permissions:t.permissions};if(t.password&&(a.password=t.password),(await I({data:a})).success){const P=await v({data:{limit:100,offset:0,sortBy:"createdAt",sortOrder:"desc"}});u(P.data),r("User updated successfully","success"),d("users"),f(null),o()}else r("Failed to update user","error")}catch(a){r(a instanceof Error?a.message:"Failed to update user","error")}finally{p(!1)}}},E=(s,a)=>{i(l=>({...l,permissions:{...l.permissions,[s]:{...l.permissions[s],[a]:!l.permissions[s]?.[a]}}}))},j=(s,a)=>{i(l=>({...l,permissions:{...l.permissions,[s]:{view:a,create:a,edit:a,delete:a}}}))};if(b==="users")return e.jsx(w,{requiredRole:["admin"],children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsxs(m,{onClick:A,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Add User"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b border-gray-200",children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold",children:s.role})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"}),e.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[e.jsx(m,{onClick:()=>C(s),className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(m,{onClick:()=>S(s.id),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white",children:e.jsx(z,{className:"w-4 h-4"})})]})]},s.id))})]})})]})});const n=b==="add";return e.jsx(w,{requiredRole:["admin"],children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n?"Add New User":"Edit User"}),e.jsx("button",{onClick:()=>{d("users"),o(),f(null)},className:"text-gray-600 hover:text-gray-900",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:n?F:D,className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"name",children:"Name *"}),e.jsx("input",{id:"name",type:"text",required:!0,value:t.name,onChange:s=>i({...t,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",children:"Email *"}),e.jsx("input",{id:"email",type:"email",required:!0,value:t.email,onChange:s=>i({...t,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"password",children:["Password ",!n&&"(leave empty to keep current)"]}),e.jsx("input",{id:"password",type:"password",required:n,value:t.password,onChange:s=>i({...t,password:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role",children:"Role *"}),e.jsxs("select",{id:"role",required:!0,value:t.role,onChange:s=>i({...t,role:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Select role"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Cashier",children:"Cashier"}),e.jsx("option",{value:"Lab Technician",children:"Lab Technician"}),e.jsx("option",{value:"Receptionist",children:"Receptionist"})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{id:"phone",type:"number",value:t.phoneNumber||"",onChange:s=>i({...t,phoneNumber:s.target.value?parseInt(s.target.value):void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Permissions"}),e.jsx("div",{className:"space-y-4",children:U.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.label}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>j(s.key,!0),className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200",children:"Grant All"}),e.jsx("button",{type:"button",onClick:()=>j(s.key,!1),className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Revoke All"})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:k.map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.permissions[s.key]?.[a]||!1,onChange:()=>E(s.key,a),className:"w-4 h-4 rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:a})]},a))})]},s.key))})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(m,{type:"button",onClick:()=>{d("users"),o(),f(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-700",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:g?"Saving...":n?"Create User":"Update User"})]})]})]})})}export{W as component};
